<!-- html file to display user home page created by Bhavi Mehta 21/04/2020 -->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Car Rental App</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>
<body>
<div class="content-section">
 {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                {{ message }}
            </div>
            {% endfor %}

    {% endif %}
    {% endwith %}
<div class="container mt-3">
  <h2>Welcome to RMIT Carpooling {{ email }}</h2>
  <br>
  <!-- Nav tabs -->
  <ul class="nav nav-tabs" id="myTab">
    <li class="nav-link"><a data-toggle="tab" href="#home">Home</a></li>
    <li><a class="nav-link" data-toggle="tab" href="#history">Order History</a></li>
    <li><a class="nav-link" data-toggle="tab" href="#search">Search For Cars</a></li>
    <li><a class="nav-link" data-toggle="tab" href="#available">Show available cars</a></li>
    <li><a class="nav-link" data-toggle="tab" href="#manage">Manage My Booking</a></li>
    <li><a class="nav-link" data-toggle="tab" href="#cancel">Cancel My Booking</a></li>
</ul>

  <!-- Tab panes -->
  <div class="tab-content">
    <div id="home" class="tab-pane fade in active"><br>
            <div class="col-sm-4">
              <h2>About Us</h2>
              <img src='https://galusaustralis.com/wp-content/uploads/2020/03/Carpooling-1170x610.jpg' style='width: 500px; position: absolute; top : 100px; bottom : 250px; left : 150px; right : 150px;'></img>
              <p>Some text to describe the application.</p>
            </div>
    </div>
  <!-- This is the code I'm working on --> 
   <div id="search" class="tab-pane fade"><br>
        <div class='col-md-4'>
            <h3>Find Cars</h3>
            <form action="" method="POST">
            <input type="text" placeholder="Search" name="search">
            <button type="submit" class="btn btn-outline-success" name="find">Find</button>
            <button type="submit" class="btn btn-outline-danger">Clear</button>
          </form>
                </div>
                {% if found %}
            <div class='col-md-8' id='foundcars'>
              <table class='table table-striped'>
                <thead>
                <tr>
                <th>Rego</th>
                <th>Make</th>
                <th>Model</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Color</th>
                </tr>
                </thead>
                <tbody>
                  {% for row in found %}
                  <tr>
                    <td>{{row[0]}}</td>
                    <td>{{row[1]}}</td>
                    <td>{{row[2]}}</td>
                    <td>{{row[3]}}</td>
                    <td>{{row[4]}}</td>
                    <td>{{row[5]}}</td>
                </tr>
                  {% endfor %}
                  </tbody>
            </table>
            </div>
            {% endif %}
    </div>
    <div id="history" class="tab-pane fade"><br>
      
          <div class='col-md-8'>
            {%if orderhistory%}
            <table class='table table-striped'>
                <thead>
                <tr>
                <th>Order Number</th>
                <th>Car Details</th>
                <th>Pickup Time</th>
                <th>Dropoff Time</th>
                <th>Cost</th>
                </tr></thead>
                <tbody>
                {% for row in orderhistory %}
                <tr>
                  <td>{{row.bookingnumber}}</td>
                  <td>{{row.rego}}</td>
                  <td>{{row.pickuptime}}</td>
                  <td>{{row.dropofftime}}</td>
                  <td>{{row.totalcost}}</td>
              </tr>
                {% endfor %}
                {%endif%}
            </tbody>
            </table>
          
          </div>
  </div>
  <div id="available" class="tab-pane fade"><br>
    <div class='col-md-4'>
        <h3>Find Cars</h3>
            </div>
        <div class='col-md-8'>
          {% if availablecars %}
            <table class='table table-striped'>
            <thead>
            <tr>
            <th>Rego</th>
            <th>Make</th>
            <th>Model</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Color</th>
            </tr>
            </thead>
            <tbody>
              {% for row in availablecars %}
              <tr>
                <td>{{row.rego}}</td>
                <td>{{row.make}}</td>
                <td>{{row.model}}</td>
                <td>{{row.locationLat}}</td>
                <td>{{row.locationLong}}</td>
                <td>{{row.colour}}</td>
            </tr>
              {% endfor %}
              {% else %}
              <h3>Sorry! We are currently booked out!</h3>
              {%endif%}
              </tbody>
        </table>
        </div>
</div>
    <div id="manage" class="tab-pane fade"><br>
            <label><h3>Manage my booking</h3></label>
            <div class='col-md-8'>
              {% if booking %}
              <table class='table table-striped'>
              <thead>
              <tr>
              <th>Order Number</th>
              <th>Placed on</th>
              <th>Car Details</th>
              <th>Pickup Time</th>
              <th>Dropoff Time</th>
              <th>Cost</th>
              </tr></thead>
              <tbody>
              {% for row in booking %}
              <tr>
                <td>{{row[0]}}</td>
                <td>{{row[1]}}</td>
                <td>{{row[2]}}</td>
                <td>{{row[3]}}</td>
                <td>{{row[4]}}</td>
                <td>{{row[5]}}</td>
            </tr>
              {% endfor %}
              </tbody>
          </table>
          {% else %}
          <label>You have no booking history</label>
          {%endif%}
          </div>
    </div>
    <div id="cancel" class="tab-pane fade"><br>
        <h5></h5>


          <hr>
    
     <p class="font-weight-bold">Cancellation options</p>
    
    <section class="section-preview">
      <form action="{{ url_for('site.about') }}" method="POST">
        <!-- Material unchecked -->
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="id1">
          <label class="form-check-label" for="id1">Booking 1</label>
        </div>

        <div class="my-2"></div>

        <!-- Material unchecked disabled -->
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="id2">
          <label class="form-check-label" for="id2">Booking 2</label>
        </div>

        <div class="my-2"></div>

        <!-- Material unchecked disabled -->
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="id3" disabled="">
          <label class="form-check-label disabled" for="id3">Booking 3</label>
        </div>
        <button type="submit" name="cancel" class="btn btn-outline-danger">Cancel</button>
      </section>
    </form>
</div>
<div class="border-top" style="position: fixed; bottom: 10px; left:5px">
  <small class="text-muted">
     <a class="ml-2" href="{{ url_for('site.logout') }}">Logout</a>
  </small>
</div>

<script>

$("document").ready(function(){
    $("#find").click(function(){
        var search = $("#search").val();
        $.ajax({
            url: "http://localhost:5000/api/",
            type: "POST"
        }).done(function(data) {
            console.log(data);
        });
        $.ajax({
            url: "http://localhost:5000/api/",
            type: "GET",
            contentType: "application/json",
            data: JSON.stringify({"found": found})
        }).done(function(data) {
            print(data);
        });
    });
});

</script>

<script>
//$(document).ready(function(){
  //$(".nav-tabs a").click(function(){
    //$(this).tab('show');
  //});
//});
$(document).ready(function(){
    $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
        localStorage.setItem('activeTab', $(e.target).attr('href'));
    });
    var activeTab = localStorage.getItem('activeTab');
    if(activeTab){
        $('#myTab a[href="' + activeTab + '"]').tab('show');
    }
});
</script>
</body>
</html>


